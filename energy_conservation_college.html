<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>能量与能量守恒定律 - 大学物理教学</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                tags: 'ams'
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            line-height: 1.7;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 50px 0;
        }

        .header h1 {
            font-size: 3.2em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 300;
        }

        .header .subtitle {
            font-size: 1.3em;
            opacity: 0.9;
            margin-bottom: 25px;
            font-style: italic;
        }

        .header .description {
            font-size: 1.1em;
            opacity: 0.8;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .content-section {
            background: white;
            border-radius: 18px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 12px 35px rgba(0,0,0,0.1);
            position: relative;
        }

        .content-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 18px 18px 0 0;
        }

        .section-title {
            font-size: 2.3em;
            color: #2c3e50;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            font-weight: 400;
        }

        .section-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            font-weight: bold;
        }

        .principle-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .principle-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            font-weight: 400;
        }

        .derivation-box {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            border-left: 6px solid #667eea;
        }

        .derivation-title {
            color: #2c3e50;
            font-size: 1.6em;
            margin-bottom: 25px;
            font-weight: 500;
        }

        .step-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .step-title {
            font-weight: bold;
            color: #2980b9;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .formula-highlight {
            background: rgba(52, 152, 219, 0.1);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            margin: 20px 0;
            text-align: center;
        }

        .concept-box {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid #e67e22;
        }

        .concept-box h3 {
            color: #d35400;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .simulation-container {
            background: #34495e;
            border-radius: 18px;
            padding: 35px;
            margin: 35px 0;
            color: white;
            box-shadow: 0 12px 35px rgba(0,0,0,0.2);
        }

        .simulation-title {
            font-size: 2em;
            text-align: center;
            margin-bottom: 30px;
            color: #3498db;
            font-weight: 300;
        }

        .demo-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        canvas {
            border: 3px solid #2c3e50;
            border-radius: 12px;
            background: #ecf0f1;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .controls-panel {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-label {
            font-weight: 500;
            color: #ecf0f1;
            font-size: 1.1em;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 22px;
            height: 22px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .control-value {
            background: rgba(52, 152, 219, 0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1em;
            text-align: center;
            font-weight: 500;
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .btn.secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .btn.reset {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .energy-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .energy-meter {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .energy-meter:hover {
            transform: translateY(-5px);
        }

        .meter-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #3498db;
            font-weight: 500;
        }

        .meter-value {
            font-size: 2.2em;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
        }

        .meter-unit {
            font-size: 0.7em;
            opacity: 0.8;
        }

        .energy-bar {
            width: 100%;
            height: 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 6px;
            margin-top: 15px;
            overflow: hidden;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.5s ease;
            border-radius: 6px;
        }

        .physics-explanation {
            background: #2c3e50;
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }

        .physics-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #3498db;
            text-align: center;
        }

        .equation-display {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .applications-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 35px 0;
        }

        .application-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-top: 5px solid #667eea;
            transition: transform 0.3s ease;
        }

        .application-card:hover {
            transform: translateY(-8px);
        }

        .app-icon {
            font-size: 3.5em;
            text-align: center;
            margin-bottom: 20px;
        }

        .app-title {
            color: #2c3e50;
            font-size: 1.5em;
            margin-bottom: 15px;
            font-weight: 500;
            text-align: center;
        }

        .app-description {
            line-height: 1.8;
            margin-bottom: 20px;
            text-align: justify;
        }

        .app-formula {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-family: 'Courier New', monospace;
            border-left: 4px solid #3498db;
            font-size: 1.1em;
        }

        .quiz-section {
            background: #2c3e50;
            color: white;
            border-radius: 20px;
            padding: 40px;
            margin-top: 50px;
        }

        .quiz-title {
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 40px;
            color: #3498db;
            font-weight: 300;
        }

        .question-container {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            display: none;
        }

        .question-container.active {
            display: block;
        }

        .question-text {
            font-size: 1.3em;
            margin-bottom: 25px;
            line-height: 1.7;
        }

        .question-image {
            text-align: center;
            margin: 25px 0;
        }

        .options-list {
            display: grid;
            gap: 15px;
            margin-top: 25px;
        }

        .option-item {
            background: rgba(255,255,255,0.1);
            padding: 18px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-size: 1.1em;
        }

        .option-item:hover {
            background: rgba(255,255,255,0.2);
        }

        .option-item.correct {
            border-color: #2ecc71;
            background: rgba(46, 204, 113, 0.3);
        }

        .option-item.incorrect {
            border-color: #e74c3c;
            background: rgba(231, 76, 60, 0.3);
        }

        .feedback-section {
            margin-top: 25px;
            padding: 20px;
            border-radius: 10px;
            display: none;
            font-size: 1.1em;
            line-height: 1.7;
        }

        .feedback-section.show {
            display: block;
        }

        .feedback-section.correct {
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
        }

        .feedback-section.incorrect {
            background: rgba(231, 76, 60, 0.2);
            border: 2px solid #e74c3c;
        }

        .quiz-navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .progress-bar {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 30px 0;
        }

        .progress-circle {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }

        .progress-circle.active {
            background: #3498db;
            transform: scale(1.2);
        }

        .progress-circle.completed {
            background: #2ecc71;
        }

        .quiz-results {
            text-align: center;
            font-size: 1.3em;
            margin-top: 40px;
            display: none;
        }

        .quiz-results.show {
            display: block;
        }

        .score-display {
            font-size: 3em;
            font-weight: bold;
            color: #3498db;
            margin: 25px 0;
        }

        .performance-feedback {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            line-height: 1.8;
        }

        .note-box {
            background: #fff3cd;
            color: #856404;
            padding: 20px;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #f39c12;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2.5em;
            }
            
            .content-section {
                padding: 25px;
            }
            
            .section-title {
                font-size: 2em;
                flex-direction: column;
                text-align: center;
            }
            
            .demo-container {
                flex-direction: column;
                align-items: center;
            }
            
            canvas {
                max-width: 100%;
                height: auto;
            }
            
            .control-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 2em;
            }
            
            .section-title {
                font-size: 1.8em;
            }
            
            .applications-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <h1>能量与能量守恒定律</h1>
            <div class="subtitle">Energy and Conservation of Energy</div>
            <div class="description">
                探索自然界最基本的守恒定律之一，理解能量在不同形式之间的转换规律，
                掌握能量守恒在工程技术和日常生活中的重要应用
            </div>
        </div>

        <!-- 基本概念 -->
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-number">1</span>
                能量的基本概念
            </h2>
            
            <div class="principle-box">
                <div class="principle-title">什么是能量？</div>
                <p style="font-size: 1.2em; line-height: 1.8;">
                    能量是物体做功的能力。虽然我们无法直接"看见"能量，但我们可以通过它的效果来感受它的存在。
                    能量有多种不同的形式，它们可以相互转换，但总量保持不变。
                </p>
            </div>

            <div class="note-box">
                <strong>🔑 关键特征：</strong>
                <ul style="margin-top: 10px; line-height: 2;">
                    <li><strong>标量性：</strong>能量只有大小，没有方向</li>
                    <li><strong>相对性：</strong>能量的数值依赖于参考系的选择</li>
                    <li><strong>可加性：</strong>系统总能量等于各部分能量之和</li>
                    <li><strong>转换性：</strong>能量可以在不同形式之间相互转换</li>
                </ul>
            </div>

            <h3 style="color: #2c3e50; font-size: 1.8em; margin: 30px 0 20px;">主要能量形式</h3>
            
            <div class="applications-section">
                <div class="application-card">
                    <div class="app-icon">🏃‍♂️</div>
                    <div class="app-title">动能 (Kinetic Energy)</div>
                    <div class="app-description">
                        物体因运动而具有的能量。速度越大，质量越大，动能就越大。
                        汽车行驶、子弹飞行、分子热运动都具有动能。
                    </div>
                    <div class="app-formula">$E_k = \frac{1}{2}mv^2$</div>
                </div>

                <div class="application-card">
                    <div class="app-icon">⛰️</div>
                    <div class="app-title">重力势能 (Gravitational PE)</div>
                    <div class="app-description">
                        物体因在重力场中的位置而具有的能量。高度越高，重力势能越大。
                        水库中的水、高处的石头都具有重力势能。
                    </div>
                    <div class="app-formula">$E_p = mgh$</div>
                </div>

                <div class="application-card">
                    <div class="app-icon">🔄</div>
                    <div class="app-title">弹性势能 (Elastic PE)</div>
                    <div class="app-description">
                        物体因发生弹性形变而具有的能量。弹簧被压缩或拉伸时，
                        橡皮筋被拉长时，都储存了弹性势能。
                    </div>
                    <div class="app-formula">$E_p = \frac{1}{2}kx^2$</div>
                </div>

                <div class="application-card">
                    <div class="app-icon">🔥</div>
                    <div class="app-title">热能 (Thermal Energy)</div>
                    <div class="app-description">
                        物质内部分子无规则运动的能量总和。温度是热能的宏观表现，
                        温度越高，分子运动越剧烈，热能越大。
                    </div>
                    <div class="app-formula">$Q = mc\Delta T$</div>
                </div>

                <div class="application-card">
                    <div class="app-icon">⚗️</div>
                    <div class="app-title">化学能 (Chemical Energy)</div>
                    <div class="app-description">
                        储存在物质化学键中的能量。食物、燃料、电池都含有化学能。
                        通过化学反应可以释放或吸收化学能。
                    </div>
                    <div class="app-formula">燃烧：$C + O_2 \rightarrow CO_2 + \text{热能}$</div>
                </div>

                <div class="application-card">
                    <div class="app-icon">⚡</div>
                    <div class="app-title">电能 (Electrical Energy)</div>
                    <div class="app-description">
                        电荷在电场中具有的能量，或电流通过导体时传递的能量。
                        电能易于传输和控制，是现代生活不可缺少的能量形式。
                    </div>
                    <div class="app-formula">$W = UIt = \frac{U^2t}{R}$</div>
                </div>
            </div>
        </div>

        <!-- 能量守恒定律 -->
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-number">2</span>
                能量守恒定律
            </h2>

            <div class="principle-box">
                <div class="principle-title">定律表述</div>
                <div style="text-align: center; font-size: 1.3em; margin: 25px 0; line-height: 1.8;">
                    <strong>"在一个孤立系统中，能量既不能被创造，也不能被消灭，
                    只能从一种形式转换为另一种形式，而系统的总能量保持不变。"</strong>
                </div>
                <div class="formula-highlight">
                    $$E_{总} = E_{动} + E_{势} + E_{热} + E_{化学} + E_{电} + \cdots = \text{常数}$$
                </div>
            </div>

            <div class="derivation-box">
                <div class="derivation-title">🔍 数学推导：从功能关系到能量守恒</div>
                
                <div class="step-box">
                    <div class="step-title">第一步：功的定义</div>
                    <p>当力 $\vec{F}$ 使物体发生位移 $\vec{s}$ 时，力对物体所做的功为：</p>
                    <div class="formula-highlight">$$W = \vec{F} \cdot \vec{s} = Fs\cos\theta$$</div>
                    <p>其中 $\theta$ 是力与位移方向的夹角。</p>
                </div>

                <div class="step-box">
                    <div class="step-title">第二步：动能定理</div>
                    <p>根据牛顿第二定律 $F = ma$ 和运动学关系，可以推导出：</p>
                    <div class="formula-highlight">$$W_{合} = \Delta E_k = \frac{1}{2}mv_2^2 - \frac{1}{2}mv_1^2$$</div>
                    <p>即：合外力做功等于物体动能的变化。</p>
                </div>

                <div class="step-box">
                    <div class="step-title">第三步：保守力与势能</div>
                    <p>对于保守力（如重力、弹力），力做功只与起点和终点位置有关，与路径无关。
                    我们可以定义势能函数：</p>
                    <div class="formula-highlight">$$W_{保守力} = -\Delta E_p = E_{p1} - E_{p2}$$</div>
                </div>

                <div class="step-box">
                    <div class="step-title">第四步：机械能守恒</div>
                    <p>当只有保守力做功时，由动能定理：</p>
                    $$W_{保守力} = \Delta E_k$$
                    $$E_{p1} - E_{p2} = E_{k2} - E_{k1}$$
                    <p>整理得到：</p>
                    <div class="formula-highlight">$$E_{k1} + E_{p1} = E_{k2} + E_{p2} = E_{机械} = \text{常数}$$</div>
                </div>

                <div class="step-box">
                    <div class="step-title">第五步：普遍的能量守恒</div>
                    <p>当考虑摩擦、热传导等非保守过程时，机械能可能减少，但这些"消失"的机械能
                    转化为热能、声能等其他形式。包括所有形式能量在内的总能量仍然守恒。</p>
                </div>
            </div>

            <div class="concept-box">
                <h3>💡 深度理解</h3>
                <p><strong>为什么能量守恒如此重要？</strong></p>
                <ul style="line-height: 2; margin-top: 15px;">
                    <li><strong>普遍性：</strong>适用于宏观世界和微观世界的所有物理过程</li>
                    <li><strong>实用性：</strong>工程设计、能源利用的理论基础</li>
                    <li><strong>预测性：</strong>可以预测系统的行为和演化</li>
                    <li><strong>限制性：</strong>告诉我们什么是可能的，什么是不可能的</li>
                </ul>
            </div>
        </div>

        <!-- 交互演示1：单摆 -->
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-number">3</span>
                演示一：单摆的能量转换
            </h2>

            <div class="simulation-container">
                <div class="simulation-title">🔄 观察动能与势能的完美切换</div>
                
                <div class="demo-container">
                    <canvas id="pendulum-canvas" width="500" height="400"></canvas>
                </div>

                <div class="controls-panel">
                    <div class="control-grid">
                        <div class="control-item">
                            <label class="control-label">摆长 $L$ (m)</label>
                            <input type="range" id="pendulum-length" min="0.5" max="2.5" step="0.1" value="1.5">
                            <span class="control-value" id="pendulum-length-value">1.5</span>
                        </div>
                        <div class="control-item">
                            <label class="control-label">初始角度 $\theta_0$ (°)</label>
                            <input type="range" id="pendulum-angle" min="10" max="60" step="2" value="30">
                            <span class="control-value" id="pendulum-angle-value">30</span>
                        </div>
                        <div class="control-item">
                            <label class="control-label">摆球质量 $m$ (kg)</label>
                            <input type="range" id="pendulum-mass" min="0.5" max="3" step="0.1" value="1">
                            <span class="control-value" id="pendulum-mass-value">1.0</span>
                        </div>
                        <div class="control-item">
                            <label class="control-label">阻尼系数</label>
                            <input type="range" id="pendulum-damping" min="0" max="0.05" step="0.005" value="0.01">
                            <span class="control-value" id="pendulum-damping-value">0.01</span>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 25px;">
                        <button class="btn" onclick="startPendulum()">▶️ 开始摆动</button>
                        <button class="btn secondary" onclick="pausePendulum()">⏸️ 暂停</button>
                        <button class="btn reset" onclick="resetPendulum()">🔄 重置</button>
                    </div>
                </div>

                <div class="energy-dashboard">
                    <div class="energy-meter">
                        <div class="meter-title">动能 $E_k$</div>
                        <div class="meter-value" id="pendulum-kinetic">0.00 <span class="meter-unit">J</span></div>
                        <div class="energy-bar">
                            <div class="energy-fill" id="pendulum-kinetic-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="energy-meter">
                        <div class="meter-title">势能 $E_p$</div>
                        <div class="meter-value" id="pendulum-potential">0.00 <span class="meter-unit">J</span></div>
                        <div class="energy-bar">
                            <div class="energy-fill" id="pendulum-potential-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="energy-meter">
                        <div class="meter-title">机械能 $E_{机}$</div>
                        <div class="meter-value" id="pendulum-mechanical">0.00 <span class="meter-unit">J</span></div>
                        <div class="energy-bar">
                            <div class="energy-fill" id="pendulum-mechanical-bar" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="energy-meter">
                        <div class="meter-title">损失能量</div>
                        <div class="meter-value" id="pendulum-lost">0.00 <span class="meter-unit">J</span></div>
                        <div class="energy-bar">
                            <div class="energy-fill" id="pendulum-lost-bar" style="width: 0%; background: #e74c3c;"></div>
                        </div>
                    </div>
                </div>

                <div class="physics-explanation">
                    <div class="physics-title">物理分析</div>
                    <div class="equation-display">
                        <p><strong>理想单摆的能量关系：</strong></p>
                        $$E_k = \frac{1}{2}mv^2 = \frac{1}{2}mL^2\dot{\theta}^2$$
                        $$E_p = mgh = mgL(1 - \cos\theta)$$
                        $$E_{机} = E_k + E_p = \text{常数（无阻尼时）}$$
                    </div>
                    <p style="line-height: 1.8; margin-top: 20px;">
                        <strong>观察要点：</strong>在最高点，摆球速度为零，动能为零，势能最大；
                        在最低点，势能最小，动能最大。整个过程中，动能和势能相互转换，
                        但总的机械能保持不变（忽略阻尼时）。
                    </p>
                </div>
            </div>
        </div>

        <!-- 交互演示2：弹性碰撞 -->
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-number">4</span>
                演示二：弹性碰撞中的能量守恒
            </h2>

            <div class="simulation-container">
                <div class="simulation-title">⚽ 探索碰撞过程中的动量与能量守恒</div>
                
                <div class="demo-container">
                    <canvas id="collision-canvas" width="600" height="350"></canvas>
                </div>

                <div class="controls-panel">
                    <div class="control-grid">
                        <div class="control-item">
                            <label class="control-label">球1质量 $m_1$ (kg)</label>
                            <input type="range" id="ball1-mass" min="0.5" max="4" step="0.1" value="2">
                            <span class="control-value" id="ball1-mass-value">2.0</span>
                        </div>
                        <div class="control-item">
                            <label class="control-label">球2质量 $m_2$ (kg)</label>
                            <input type="range" id="ball2-mass" min="0.5" max="4" step="0.1" value="1">
                            <span class="control-value" id="ball2-mass-value">1.0</span>
                        </div>
                        <div class="control-item">
                            <label class="control-label">球1初速度 $v_1$ (m/s)</label>
                            <input type="range" id="ball1-velocity" min="1" max="10" step="0.5" value="5">
                            <span class="control-value" id="ball1-velocity-value">5.0</span>
                        </div>
                        <div class="control-item">
                            <label class="control-label">恢复系数 $e$</label>
                            <input type="range" id="restitution" min="0.1" max="1" step="0.05" value="0.9">
                            <span class="control-value" id="restitution-value">0.90</span>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 25px;">
                        <button class="btn" onclick="startCollision()">🚀 开始碰撞</button>
                        <button class="btn reset" onclick="resetCollision()">🔄 重置</button>
                        <button class="btn secondary" onclick="setElastic()">完全弹性</button>
                        <button class="btn secondary" onclick="setInelastic()">完全非弹性</button>
                    </div>
                </div>

                <div class="energy-dashboard">
                    <div class="energy-meter">
                        <div class="meter-title">碰撞前动能</div>
                        <div class="meter-value" id="collision-kinetic-before">0.00 <span class="meter-unit">J</span></div>
                        <div class="energy-bar">
                            <div class="energy-fill" id="collision-kinetic-before-bar" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="energy-meter">
                        <div class="meter-title">碰撞后动能</div>
                        <div class="meter-value" id="collision-kinetic-after">0.00 <span class="meter-unit">J</span></div>
                        <div class="energy-bar">
                            <div class="energy-fill" id="collision-kinetic-after-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="energy-meter">
                        <div class="meter-title">碰撞前动量</div>
                        <div class="meter-value" id="collision-momentum-before">0.00 <span class="meter-unit">kg·m/s</span></div>
                        <div class="energy-bar">
                            <div class="energy-fill" id="collision-momentum-before-bar" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="energy-meter">
                        <div class="meter-title">碰撞后动量</div>
                        <div class="meter-value" id="collision-momentum-after">0.00 <span class="meter-unit">kg·m/s</span></div>
                        <div class="energy-bar">
                            <div class="energy-fill" id="collision-momentum-after-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="physics-explanation">
                    <div class="physics-title">碰撞理论分析</div>
                    <div class="equation-display">
                        <p><strong>动量守恒：</strong></p>
                        $$m_1 v_{1i} + m_2 v_{2i} = m_1 v_{1f} + m_2 v_{2f}$$
                        <br>
                        <p><strong>弹性碰撞时能量也守恒：</strong></p>
                        $$\frac{1}{2}m_1 v_{1i}^2 + \frac{1}{2}m_2 v_{2i}^2 = \frac{1}{2}m_1 v_{1f}^2 + \frac{1}{2}m_2 v_{2f}^2$$
                    </div>
                    <p style="line-height: 1.8; margin-top: 20px;">
                        <strong>重要发现：</strong>动量在任何碰撞中都守恒，但动能只在完全弹性碰撞中守恒。
                        恢复系数 $e$ 反映了碰撞的弹性程度：$e = 1$ 完全弹性，$e = 0$ 完全非弹性。
                    </p>
                </div>
            </div>
        </div>

        <!-- 实际应用 -->
        <div class="content-section">
            <h2 class="section-title">
                <span class="section-number">5</span>
                能量守恒在现实中的应用
            </h2>

            <div class="applications-section">
                <div class="application-card">
                    <div class="app-icon">🚗</div>
                    <div class="app-title">汽车制动系统</div>
                    <div class="app-description">
                        汽车刹车时，车辆的动能通过摩擦转化为热能散发到环境中。
                        制动距离的计算就基于能量守恒定律。现代混合动力汽车还能
                        将部分动能回收转化为电能储存起来。
                    </div>
                    <div class="app-formula">$\frac{1}{2}mv^2 = \mu mg s$ （制动距离公式）</div>
                </div>

                <div class="application-card">
                    <div class="app-icon">💧</div>
                    <div class="app-title">水力发电</div>
                    <div class="app-description">
                        水库中高处的水具有重力势能，流向低处时转化为动能，
                        推动水轮机旋转，进而带动发电机将机械能转化为电能。
                        整个过程遵循能量守恒，但有一定的效率损失。
                    </div>
                    <div class="app-formula">$P = \eta \rho g Q H$ （水力发电功率）</div>
                </div>

                <div class="application-card">
                    <div class="app-icon">🎢</div>
                    <div class="app-title">过山车设计</div>
                    <div class="app-description">
                        过山车的设计完全基于能量守恒。起始点的高度决定了整条
                        轨道的最大势能，后续的每个坡度都不能超过这个高度
                        （考虑摩擦损失），这确保了过山车能够完成整个行程。
                    </div>
                    <div class="app-formula">$mgh_0 = mgh + \frac{1}{2}mv^2 + Q_{摩擦}$</div>
                </div>

                <div class="application-card">
                    <div class="app-icon">🔋</div>
                    <div class="app-title">电池储能技术</div>
                    <div class="app-description">
                        电池通过化学反应将化学能转化为电能。充电时电能转化为
                        化学能储存，放电时化学能又转化为电能。能量转换效率
                        是评价电池性能的重要指标。
                    </div>
                    <div class="app-formula">$\eta = \frac{W_{输出}}{W_{输入}} \times 100\%$</div>
                </div>

                <div class="application-card">
                    <div class="app-icon">🏠</div>
                    <div class="app-title">建筑节能设计</div>
                    <div class="app-description">
                        建筑物的保温设计基于热能传递和守恒。通过合理的保温材料
                        和结构设计，减少热能损失，提高能源利用效率。
                        太阳能建筑将太阳的辐射能转化为热能和电能。
                    </div>
                    <div class="app-formula">$Q = \frac{k A \Delta T t}{d}$ （热传导公式）</div>
                </div>

                <div class="application-card">
                    <div class="app-icon">🚀</div>
                    <div class="app-title">航天器轨道设计</div>
                    <div class="app-description">
                        航天器在轨道上运行时，动能和势能不断相互转换。
                        在近地点速度最大（动能最大），在远地点速度最小（势能最大）。
                        轨道机动和变轨都要精确计算能量需求。
                    </div>
                    <div class="app-formula">$E = -\frac{GMm}{2a}$ （轨道总能量）</div>
                </div>
            </div>
        </div>

        <!-- 智能测验 -->
        <div class="quiz-section">
            <h2 class="quiz-title">🧠 综合理解测验</h2>
            <p style="text-align: center; font-size: 1.2em; margin-bottom: 40px; opacity: 0.9;">
                测试你对能量守恒定律的掌握程度，包括概念理解和实际应用
            </p>

            <div class="progress-bar" id="quiz-progress"></div>

            <div id="quiz-container"></div>

            <div class="quiz-navigation">
                <button class="btn secondary" id="prev-question" onclick="previousQuestion()" style="display: none;">⬅️ 上一题</button>
                <button class="btn" id="next-question" onclick="nextQuestion()" style="display: none;">下一题 ➡️</button>
            </div>

            <div class="quiz-results" id="quiz-results">
                <h3>🎉 测验完成！</h3>
                <div class="score-display" id="final-score-display"></div>
                <div class="performance-feedback" id="performance-feedback"></div>
                <button class="btn" onclick="restartQuiz()">🔄 重新开始</button>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let pendulumAnimation, collisionAnimation;
        let currentQuestionIndex = 0;
        let quizScore = 0;
        let userAnswers = [];

        // 测验题目
        const quizQuestions = [
            {
                question: "一个质量为2kg的物体从10m高处自由落下，忽略空气阻力，落地时的速度大小是多少？（g=10m/s²）",
                image: "物体自由落下示意图",
                options: [
                    "10 m/s",
                    "14.1 m/s", 
                    "20 m/s",
                    "100 m/s"
                ],
                correct: 1,
                explanation: "根据能量守恒定律：$mgh = \\frac{1}{2}mv^2$，解得 $v = \\sqrt{2gh} = \\sqrt{2 \\times 10 \\times 10} = 14.1$ m/s。注意这里不需要知道物体的质量。"
            },
            {
                question: "在单摆运动中，当摆球通过最低点时，下列说法正确的是：",
                options: [
                    "动能最小，势能最大",
                    "动能最大，势能最小",
                    "动能和势能都最大",
                    "动能和势能都最小"
                ],
                correct: 1,
                explanation: "在最低点，摆球的高度最小（势能最小），速度最大（动能最大）。这是势能向动能转换的结果。"
            },
            {
                question: "两个质量分别为2kg和3kg的物体发生完全弹性碰撞，碰撞前2kg物体以4m/s的速度运动，3kg物体静止。碰撞后2kg物体的速度是：",
                options: [
                    "-0.8 m/s",
                    "0.8 m/s",
                    "1.6 m/s", 
                    "2.4 m/s"
                ],
                correct: 0,
                explanation: "完全弹性碰撞同时满足动量守恒和能量守恒。使用公式：$v_1' = \\frac{(m_1-m_2)v_1}{m_1+m_2} = \\frac{(2-3) \\times 4}{2+3} = -0.8$ m/s。负号表示方向与初始方向相反。"
            },
            {
                question: "关于能量守恒定律，下列理解正确的是：",
                options: [
                    "能量守恒只适用于机械运动",
                    "在有摩擦的过程中，机械能不守恒，但总能量仍然守恒",
                    "能量可以被创造，但不能被消灭",
                    "能量守恒定律只在理想情况下成立"
                ],
                correct: 1,
                explanation: "能量守恒定律是自然界的普遍规律。虽然摩擦会使机械能转化为热能，但包括热能在内的总能量仍然守恒。能量既不能被创造也不能被消灭，只能转换形式。"
            },
            {
                question: "一辆汽车以20m/s的速度行驶，质量为1000kg。如果要在50m的距离内停下，制动力至少应该是多少？",
                options: [
                    "2000 N",
                    "4000 N",
                    "6000 N",
                    "8000 N"
                ],
                correct: 1,
                explanation: "根据动能定理：$F \\cdot s = \\frac{1}{2}mv^2$，解得 $F = \\frac{mv^2}{2s} = \\frac{1000 \\times 20^2}{2 \\times 50} = 4000$ N。"
            },
            {
                question: "水力发电中，水从100m高处流下，每秒流量为10m³，水的密度为1000kg/m³，重力加速度g=10m/s²，理论上的发电功率是：",
                options: [
                    "1 MW",
                    "5 MW", 
                    "10 MW",
                    "100 MW"
                ],
                correct: 2,
                explanation: "功率 $P = \\frac{mgh}{t} = \\rho V g h = 1000 \\times 10 \\times 10 \\times 100 = 10^7$ W = 10 MW。这是理论功率，实际功率会因效率而降低。"
            }
        ];

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializePendulum();
            initializeCollision();
            initializeQuiz();
            setupControlListeners();
        });

        // 设置控制器监听
        function setupControlListeners() {
            // 单摆控制器
            const pendulumControls = ['pendulum-length', 'pendulum-angle', 'pendulum-mass', 'pendulum-damping'];
            pendulumControls.forEach(id => {
                const slider = document.getElementById(id);
                const valueSpan = document.getElementById(id + '-value');
                slider.addEventListener('input', function() {
                    valueSpan.textContent = parseFloat(this.value).toFixed(2);
                });
            });

            // 碰撞控制器
            const collisionControls = ['ball1-mass', 'ball2-mass', 'ball1-velocity', 'restitution'];
            collisionControls.forEach(id => {
                const slider = document.getElementById(id);
                const valueSpan = document.getElementById(id + '-value');
                slider.addEventListener('input', function() {
                    valueSpan.textContent = parseFloat(this.value).toFixed(2);
                    if (!document.getElementById('collision-canvas').dataset.animating) {
                        updateCollisionDisplay();
                    }
                });
            });
        }

        // 单摆仿真
        function initializePendulum() {
            const canvas = document.getElementById('pendulum-canvas');
            const ctx = canvas.getContext('2d');
            
            let pendulum = {
                angle: Math.PI/6,
                angleVel: 0,
                angleAcc: 0,
                length: 150,
                origin: { x: canvas.width/2, y: 50 },
                mass: 1,
                gravity: 9.8,
                damping: 0.999,
                isRunning: false,
                initialEnergy: 0
            };

            function updatePendulum() {
                if (!pendulum.isRunning) return;

                const length = parseFloat(document.getElementById('pendulum-length').value);
                const mass = parseFloat(document.getElementById('pendulum-mass').value);
                const damping = 1 - parseFloat(document.getElementById('pendulum-damping').value);

                pendulum.length = length * 100;
                pendulum.mass = mass;
                pendulum.damping = damping;

                pendulum.angleAcc = -(pendulum.gravity / (pendulum.length / 100)) * Math.sin(pendulum.angle);
                pendulum.angleVel += pendulum.angleAcc * 0.016;
                pendulum.angleVel *= pendulum.damping;
                pendulum.angle += pendulum.angleVel * 0.016;

                // 计算能量
                const height = pendulum.length * (1 - Math.cos(pendulum.angle)) / 100;
                const velocity = Math.abs(pendulum.angleVel * pendulum.length / 100);
                
                const potentialEnergy = pendulum.mass * pendulum.gravity * height;
                const kineticEnergy = 0.5 * pendulum.mass * velocity * velocity;
                const mechanicalEnergy = potentialEnergy + kineticEnergy;
                const lostEnergy = pendulum.initialEnergy - mechanicalEnergy;

                updatePendulumDisplay(kineticEnergy, potentialEnergy, mechanicalEnergy, lostEnergy);
            }

            function drawPendulum() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // 绘制悬挂点
                ctx.fillStyle = '#2c3e50';
                ctx.beginPath();
                ctx.arc(pendulum.origin.x, pendulum.origin.y, 8, 0, 2*Math.PI);
                ctx.fill();

                // 计算摆球位置
                const ballX = pendulum.origin.x + pendulum.length * Math.sin(pendulum.angle);
                const ballY = pendulum.origin.y + pendulum.length * Math.cos(pendulum.angle);

                // 绘制摆线
                ctx.strokeStyle = '#34495e';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(pendulum.origin.x, pendulum.origin.y);
                ctx.lineTo(ballX, ballY);
                ctx.stroke();

                // 绘制轨迹弧线
                ctx.strokeStyle = 'rgba(52, 152, 219, 0.3)';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                const maxAngle = parseFloat(document.getElementById('pendulum-angle').value) * Math.PI / 180;
                ctx.arc(pendulum.origin.x, pendulum.origin.y, pendulum.length, Math.PI/2 - maxAngle, Math.PI/2 + maxAngle);
                ctx.stroke();
                ctx.setLineDash([]);

                // 绘制摆球
                const radius = 12 + pendulum.mass * 8;
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath();
                ctx.arc(ballX, ballY, radius, 0, 2*Math.PI);
                ctx.fill();
                ctx.strokeStyle = '#c0392b';
                ctx.lineWidth = 2;
                ctx.stroke();

                // 绘制速度矢量
                if (pendulum.isRunning && Math.abs(pendulum.angleVel) > 0.1) {
                    const velScale = 50;
                    const velX = -pendulum.angleVel * Math.cos(pendulum.angle) * velScale;
                    const velY = pendulum.angleVel * Math.sin(pendulum.angle) * velScale;
                    
                    ctx.strokeStyle = '#3498db';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(ballX, ballY);
                    ctx.lineTo(ballX + velX, ballY + velY);
                    ctx.stroke();
                    
                    // 箭头
                    const arrowSize = 8;
                    const angle = Math.atan2(velY, velX);
                    ctx.beginPath();
                    ctx.moveTo(ballX + velX, ballY + velY);
                    ctx.lineTo(ballX + velX - arrowSize * Math.cos(angle - Math.PI/6), 
                              ballY + velY - arrowSize * Math.sin(angle - Math.PI/6));
                    ctx.moveTo(ballX + velX, ballY + velY);
                    ctx.lineTo(ballX + velX - arrowSize * Math.cos(angle + Math.PI/6), 
                              ballY + velY - arrowSize * Math.sin(angle + Math.PI/6));
                    ctx.stroke();
                }

                // 绘制角度标注
                ctx.fillStyle = '#7f8c8d';
                ctx.font = '14px Arial';
                ctx.fillText(`θ = ${(pendulum.angle * 180/Math.PI).toFixed(1)}°`, 20, 30);
                ctx.fillText(`ω = ${pendulum.angleVel.toFixed(2)} rad/s`, 20, 50);
            }

            function animate() {
                updatePendulum();
                drawPendulum();
                if (pendulum.isRunning) {
                    pendulumAnimation = requestAnimationFrame(animate);
                }
            }

            window.startPendulum = function() {
                const angle = parseFloat(document.getElementById('pendulum-angle').value) * Math.PI / 180;
                const length = parseFloat(document.getElementById('pendulum-length').value);
                const mass = parseFloat(document.getElementById('pendulum-mass').value);
                
                pendulum.angle = angle;
                pendulum.angleVel = 0;
                pendulum.mass = mass;
                pendulum.length = length * 100;
                
                // 计算初始能量
                const initialHeight = pendulum.length * (1 - Math.cos(pendulum.angle)) / 100;
                pendulum.initialEnergy = pendulum.mass * pendulum.gravity * initialHeight;
                
                pendulum.isRunning = true;
                animate();
            };

            window.pausePendulum = function() {
                pendulum.isRunning = !pendulum.isRunning;
                if (pendulum.isRunning) animate();
            };

            window.resetPendulum = function() {
                if (pendulumAnimation) cancelAnimationFrame(pendulumAnimation);
                pendulum.isRunning = false;
                
                const angle = parseFloat(document.getElementById('pendulum-angle').value) * Math.PI / 180;
                pendulum.angle = angle;
                pendulum.angleVel = 0;
                
                drawPendulum();
                updatePendulumDisplay(0, 0, 0, 0);
            };

            // 初始绘制
            drawPendulum();
        }

        // 碰撞仿真
        function initializeCollision() {
            const canvas = document.getElementById('collision-canvas');
            const ctx = canvas.getContext('2d');
            
            let balls = {
                ball1: { x: 100, y: canvas.height/2, vx: 0, vy: 0, mass: 2, radius: 25, color: '#e74c3c' },
                ball2: { x: 500, y: canvas.height/2, vx: 0, vy: 0, mass: 1, radius: 20, color: '#3498db' },
                collisionOccurred: false,
                isAnimating: false
            };

            function drawCollision() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // 绘制地面
                ctx.fillStyle = '#34495e';
                ctx.fillRect(0, canvas.height - 20, canvas.width, 20);
                
                // 绘制球1
                ctx.fillStyle = balls.ball1.color;
                ctx.beginPath();
                ctx.arc(balls.ball1.x, balls.ball1.y, balls.ball1.radius, 0, 2*Math.PI);
                ctx.fill();
                ctx.strokeStyle = '#c0392b';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // 球1标签
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('1', balls.ball1.x, balls.ball1.y + 5);
                
                // 绘制球2
                ctx.fillStyle = balls.ball2.color;
                ctx.beginPath();
                ctx.arc(balls.ball2.x, balls.ball2.y, balls.ball2.radius, 0, 2*Math.PI);
                ctx.fill();
                ctx.strokeStyle = '#2980b9';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // 球2标签
                ctx.fillStyle = 'white';
                ctx.fillText('2', balls.ball2.x, balls.ball2.y + 5);
                
                // 绘制速度矢量
                if (balls.ball1.vx !== 0 || balls.isAnimating) {
                    drawVelocityVector(balls.ball1.x, balls.ball1.y - balls.ball1.radius - 20, 
                                     balls.ball1.vx * 20, balls.ball1.color, 'v₁');
                }
                if (balls.ball2.vx !== 0 || balls.isAnimating) {
                    drawVelocityVector(balls.ball2.x, balls.ball2.y - balls.ball2.radius - 20, 
                                     balls.ball2.vx * 20, balls.ball2.color, 'v₂');
                }
            }

            function drawVelocityVector(x, y, length, color, label) {
                if (Math.abs(length) < 5) return;
                
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(x + length, y);
                ctx.stroke();
                
                // 箭头
                const arrowSize = 8;
                ctx.beginPath();
                ctx.moveTo(x + length, y);
                ctx.lineTo(x + length - arrowSize, y - 5);
                ctx.moveTo(x + length, y);
                ctx.lineTo(x + length - arrowSize, y + 5);
                ctx.stroke();
                
                // 标签
                ctx.fillStyle = color;
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(label, x + length/2, y - 10);
            }

            function updateCollisionDisplay() {
                const m1 = parseFloat(document.getElementById('ball1-mass').value);
                const m2 = parseFloat(document.getElementById('ball2-mass').value);
                const v1 = parseFloat(document.getElementById('ball1-velocity').value);
                const e = parseFloat(document.getElementById('restitution').value);
                
                balls.ball1.mass = m1;
                balls.ball2.mass = m2;
                balls.ball1.radius = 15 + m1 * 5;
                balls.ball2.radius = 15 + m2 * 5;
                
                // 计算碰撞前
                const momentumBefore = m1 * v1;
                const kineticBefore = 0.5 * m1 * v1 * v1;
                
                // 计算碰撞后速度
                const v1After = ((m1 - e * m2) * v1) / (m1 + m2);
                const v2After = (m1 * (1 + e) * v1) / (m1 + m2);
                
                const momentumAfter = m1 * v1After + m2 * v2After;
                const kineticAfter = 0.5 * m1 * v1After * v1After + 0.5 * m2 * v2After * v2After;
                
                // 更新显示
                document.getElementById('collision-kinetic-before').innerHTML = 
                    kineticBefore.toFixed(2) + ' <span class="meter-unit">J</span>';
                document.getElementById('collision-kinetic-after').innerHTML = 
                    kineticAfter.toFixed(2) + ' <span class="meter-unit">J</span>';
                document.getElementById('collision-momentum-before').innerHTML = 
                    momentumBefore.toFixed(2) + ' <span class="meter-unit">kg·m/s</span>';
                document.getElementById('collision-momentum-after').innerHTML = 
                    momentumAfter.toFixed(2) + ' <span class="meter-unit">kg·m/s</span>';
                
                // 更新进度条
                const maxKinetic = Math.max(kineticBefore, kineticAfter, 1);
                const maxMomentum = Math.max(Math.abs(momentumBefore), Math.abs(momentumAfter), 1);
                
                document.getElementById('collision-kinetic-before-bar').style.width = 
                    (kineticBefore / maxKinetic * 100) + '%';
                document.getElementById('collision-kinetic-after-bar').style.width = 
                    (kineticAfter / maxKinetic * 100) + '%';
                document.getElementById('collision-momentum-before-bar').style.width = 
                    (Math.abs(momentumBefore) / maxMomentum * 100) + '%';
                document.getElementById('collision-momentum-after-bar').style.width = 
                    (Math.abs(momentumAfter) / maxMomentum * 100) + '%';
                
                drawCollision();
            }

            function animateCollision() {
                if (!balls.isAnimating) return;
                
                balls.ball1.x += balls.ball1.vx * 2;
                balls.ball2.x += balls.ball2.vx * 2;
                
                // 检查碰撞
                const distance = Math.abs(balls.ball2.x - balls.ball1.x);
                const minDistance = balls.ball1.radius + balls.ball2.radius;
                
                if (distance <= minDistance && !balls.collisionOccurred && balls.ball1.vx > 0) {
                    performCollision();
                    balls.collisionOccurred = true;
                }
                
                drawCollision();
                
                // 检查边界
                if (balls.ball1.x > canvas.width + 100 || balls.ball2.x > canvas.width + 100) {
                    balls.isAnimating = false;
                    canvas.dataset.animating = 'false';
                    return;
                }
                
                if (balls.isAnimating) {
                    collisionAnimation = requestAnimationFrame(animateCollision);
                }
            }

            function performCollision() {
                const m1 = balls.ball1.mass;
                const m2 = balls.ball2.mass;
                const v1 = balls.ball1.vx;
                const v2 = balls.ball2.vx;
                const e = parseFloat(document.getElementById('restitution').value);
                
                // 一维弹性碰撞公式
                balls.ball1.vx = ((m1 - e * m2) * v1 + m2 * (1 + e) * v2) / (m1 + m2);
                balls.ball2.vx = ((m2 - e * m1) * v2 + m1 * (1 + e) * v1) / (m1 + m2);
            }

            window.startCollision = function() {
                balls.collisionOccurred = false;
                balls.isAnimating = true;
                canvas.dataset.animating = 'true';
                
                // 重置位置
                balls.ball1.x = 100;
                balls.ball2.x = 500;
                
                // 设置初始速度
                balls.ball1.vx = parseFloat(document.getElementById('ball1-velocity').value);
                balls.ball2.vx = 0;
                
                updateCollisionDisplay();
                animateCollision();
            };

            window.resetCollision = function() {
                if (collisionAnimation) cancelAnimationFrame(collisionAnimation);
                balls.isAnimating = false;
                balls.collisionOccurred = false;
                canvas.dataset.animating = 'false';
                
                balls.ball1.x = 100;
                balls.ball2.x = 500;
                balls.ball1.vx = 0;
                balls.ball2.vx = 0;
                
                updateCollisionDisplay();
            };

            window.setElastic = function() {
                document.getElementById('restitution').value = '1.00';
                document.getElementById('restitution-value').textContent = '1.00';
                updateCollisionDisplay();
            };

            window.setInelastic = function() {
                document.getElementById('restitution').value = '0.00';
                document.getElementById('restitution-value').textContent = '0.00';
                updateCollisionDisplay();
            };

            // 初始化显示
            updateCollisionDisplay();
        }

        // 能量显示更新函数
        function updatePendulumDisplay(kinetic, potential, mechanical, lost) {
            document.getElementById('pendulum-kinetic').innerHTML = 
                kinetic.toFixed(2) + ' <span class="meter-unit">J</span>';
            document.getElementById('pendulum-potential').innerHTML = 
                potential.toFixed(2) + ' <span class="meter-unit">J</span>';
            document.getElementById('pendulum-mechanical').innerHTML = 
                mechanical.toFixed(2) + ' <span class="meter-unit">J</span>';
            document.getElementById('pendulum-lost').innerHTML = 
                lost.toFixed(2) + ' <span class="meter-unit">J</span>';
            
            const maxEnergy = Math.max(mechanical + lost, 1);
            
            document.getElementById('pendulum-kinetic-bar').style.width = 
                (kinetic / maxEnergy * 100) + '%';
            document.getElementById('pendulum-potential-bar').style.width = 
                (potential / maxEnergy * 100) + '%';
            document.getElementById('pendulum-mechanical-bar').style.width = 
                (mechanical / maxEnergy * 100) + '%';
            document.getElementById('pendulum-lost-bar').style.width = 
                (lost / maxEnergy * 100) + '%';
        }

        // 测验系统
        function initializeQuiz() {
            createQuizHTML();
            showQuestion(0);
        }

        function createQuizHTML() {
            const progressContainer = document.getElementById('quiz-progress');
            const quizContainer = document.getElementById('quiz-container');
            
            // 创建进度指示器
            progressContainer.innerHTML = '';
            for (let i = 0; i < quizQuestions.length; i++) {
                const circle = document.createElement('div');
                circle.className = 'progress-circle';
                circle.id = `progress-${i}`;
                progressContainer.appendChild(circle);
            }
            
            // 创建题目HTML
            quizContainer.innerHTML = '';
            quizQuestions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-container';
                questionDiv.id = `question-${index}`;
                
                let optionsHTML = '';
                q.options.forEach((option, optionIndex) => {
                    optionsHTML += `
                        <div class="option-item" onclick="selectAnswer(${index}, ${optionIndex})">
                            ${String.fromCharCode(65 + optionIndex)}. ${option}
                        </div>
                    `;
                });
                
                const imageHTML = q.image ? 
                    `<div class="question-image">📊 ${q.image}</div>` : '';
                
                questionDiv.innerHTML = `
                    <h3 class="question-text">第 ${index + 1} 题：</h3>
                    <p class="question-text">${q.question}</p>
                    ${imageHTML}
                    <div class="options-list">
                        ${optionsHTML}
                    </div>
                    <div class="feedback-section" id="feedback-${index}">
                        <p id="feedback-text-${index}"></p>
                        <p><strong>详细解释：</strong></p>
                        <p>${q.explanation}</p>
                    </div>
                `;
                
                quizContainer.appendChild(questionDiv);
            });
        }

        function showQuestion(index) {
            document.querySelectorAll('.question-container').forEach(q => q.classList.remove('active'));
            document.getElementById(`question-${index}`).classList.add('active');
            
            document.querySelectorAll('.progress-circle').forEach(circle => circle.classList.remove('active'));
            document.getElementById(`progress-${index}`).classList.add('active');
            
            currentQuestionIndex = index;
            
            // 更新导航按钮
            document.getElementById('prev-question').style.display = index > 0 ? 'inline-block' : 'none';
            document.getElementById('next-question').style.display = 'none';
        }

        function selectAnswer(questionIndex, optionIndex) {
            const question = quizQuestions[questionIndex];
            const options = document.querySelectorAll(`#question-${questionIndex} .option-item`);
            const feedback = document.getElementById(`feedback-${questionIndex}`);
            const feedbackText = document.getElementById(`feedback-text-${questionIndex}`);
            
            // 记录答案
            userAnswers[questionIndex] = optionIndex;
            
            // 禁用所有选项
            options.forEach(option => option.onclick = null);
            
            // 标记正确和错误答案
            options[question.correct].classList.add('correct');
            if (optionIndex !== question.correct) {
                options[optionIndex].classList.add('incorrect');
            }
            
            // 更新分数和反馈
            if (optionIndex === question.correct) {
                quizScore++;
                feedbackText.innerHTML = '🎉 <strong>回答正确！</strong>';
                feedback.classList.add('correct');
                document.getElementById(`progress-${questionIndex}`).classList.add('completed');
            } else {
                feedbackText.innerHTML = `❌ <strong>回答错误。</strong> 正确答案是：<strong>${String.fromCharCode(65 + question.correct)}</strong>`;
                feedback.classList.add('incorrect');
            }
            
            feedback.classList.add('show');
            
            // 显示导航按钮
            if (currentQuestionIndex < quizQuestions.length - 1) {
                document.getElementById('next-question').style.display = 'inline-block';
            } else {
                // 最后一题，显示结果按钮
                const resultsBtn = document.createElement('button');
                resultsBtn.className = 'btn';
                resultsBtn.textContent = '查看结果 🎯';
                resultsBtn.onclick = showQuizResults;
                document.querySelector('.quiz-navigation').appendChild(resultsBtn);
            }
            
            // 重新渲染数学公式
            if (window.MathJax) {
                MathJax.typesetPromise([feedback]);
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < quizQuestions.length - 1) {
                showQuestion(currentQuestionIndex + 1);
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                showQuestion(currentQuestionIndex - 1);
            }
        }

        function showQuizResults() {
            document.querySelectorAll('.question-container').forEach(q => q.style.display = 'none');
            document.querySelector('.quiz-navigation').style.display = 'none';
            
            const resultsContainer = document.getElementById('quiz-results');
            const scoreDisplay = document.getElementById('final-score-display');
            const performanceFeedback = document.getElementById('performance-feedback');
            
            scoreDisplay.textContent = `${quizScore}/${quizQuestions.length}`;
            
            const percentage = (quizScore / quizQuestions.length) * 100;
            let feedback = '';
            
            if (percentage >= 90) {
                feedback = `
                    <h4 style="color: #2ecc71;">🏆 优秀表现！</h4>
                    <p>您对能量守恒定律有深入的理解！您已经掌握了从基本概念到实际应用的各个方面。
                    建议您继续探索更高级的物理概念，如热力学定律、电磁能量等。</p>
                `;
            } else if (percentage >= 70) {
                feedback = `
                    <h4 style="color: #3498db;">👍 良好掌握！</h4>
                    <p>您对大部分概念理解正确，但在某些应用问题上还需要加强。
                    建议多练习实际计算问题，加深对能量转换过程的理解。</p>
                `;
            } else if (percentage >= 50) {
                feedback = `
                    <h4 style="color: #f39c12;">📚 继续努力！</h4>
                    <p>您掌握了基本概念，但在具体应用上还需要提高。
                    建议重新复习能量的各种形式和转换规律，多做练习题。</p>
                `;
            } else {
                feedback = `
                    <h4 style="color: #e74c3c;">💪 需要加强！</h4>
                    <p>建议重新学习基础概念，特别是动能、势能的计算和能量守恒定律的应用。
                    可以通过更多的实验演示来加深理解。</p>
                `;
            }
            
            performanceFeedback.innerHTML = feedback;
            resultsContainer.classList.add('show');
        }

        function restartQuiz() {
            currentQuestionIndex = 0;
            quizScore = 0;
            userAnswers = [];
            
            document.getElementById('quiz-results').classList.remove('show');
            document.querySelector('.quiz-navigation').style.display = 'flex';
            
            // 移除结果按钮
            const resultsBtn = document.querySelector('.quiz-navigation button:last-child');
            if (resultsBtn && resultsBtn.textContent.includes('查看结果')) {
                resultsBtn.remove();
            }
            
            document.querySelectorAll('.question-container').forEach(q => {
                q.style.display = '';
                q.classList.remove('active');
            });
            
            document.querySelectorAll('.option-item').forEach(option => {
                option.classList.remove('correct', 'incorrect');
                const questionIndex = parseInt(option.closest('.question-container').id.split('-')[1]);
                const optionIndex = Array.from(option.parentNode.children).indexOf(option);
                option.onclick = function() { selectAnswer(questionIndex, optionIndex); };
            });
            
            document.querySelectorAll('.feedback-section').forEach(feedback => {
                feedback.classList.remove('show', 'correct', 'incorrect');
            });
            
            document.querySelectorAll('.progress-circle').forEach(circle => {
                circle.classList.remove('active', 'completed');
            });
            
            showQuestion(0);
        }
    </script>
</body>
</html>